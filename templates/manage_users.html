{% extends "base.html" %}

{% block title %}Manage Users - AI Restaurant{% endblock %}

{% block content %}
<div class="container my-4">
  <h1 class="mb-4">User Management</h1>

  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">All Users</h5>
    </div>
    <div class="card-body">
      {% if user_rows %}
      <div class="table-responsive">
        <table class="table table-striped table-hover align-middle table-sm" style="font-size: 0.9rem;">
          <thead class="table-light">
            <tr>
              <th style="width: 4rem;">ID</th>
              <th style="width: 9rem;">Username</th>
              <th style="width: 14rem;">Email</th>
              <th>Type</th>
              <th>Status</th>
              <th>Profile Info</th>
              <th>Employee Info</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for row in user_rows %}
            {% with u=row.user extra=row.extra %}
            <tr>
              <td>{{ u.id }}</td>
              <td><a href="{% url 'profile' u.id %}">{{ u.username }}</a></td>
              <td>{{ u.email }}</td>
              <td>
                {% if u.type == 'CU' %}Customer
                {% elif u.type == 'CH' %}Chef
                {% elif u.type == 'DL' %}Deliverer
                {% elif u.type == 'MN' %}Manager
                {% else %}{{ u.type }}{% endif %}
              </td>
              <td>{{ u.get_status_display }}</td>
              <td style="max-width: 260px; white-space: pre-wrap;">
                {% if u.type == 'CU' %}
                  {% if row.profile %}
                    Balance: ${{ row.profile.balance|floatformat:2 }}\n
                    Warnings: {{ row.profile.warnings }}\n
                    VIP: {{ row.profile.vip|yesno:"Yes,No" }}
                  {% else %}
                    <span class="text-muted">No customer profile</span>
                  {% endif %}
                {% elif u.type == 'CH' %}
                  {% if row.profile %}
                    Chef profile attached
                  {% else %}
                    <span class="text-muted">No chef profile</span>
                  {% endif %}
                {% elif u.type == 'DL' %}
                  {% if row.profile %}
                    Deliverer profile attached
                  {% else %}
                    <span class="text-muted">No deliverer profile</span>
                  {% endif %}
                {% elif u.type == 'MN' %}
                  {% if row.profile %}
                    Manager profile attached
                  {% else %}
                    <span class="text-muted">No manager profile</span>
                  {% endif %}
                {% endif %}
              </td>
              <td style="max-width: 260px; white-space: pre-wrap;">
                {% if extra.employee_status %}
                  Status: {{ extra.employee_status }}\n
                  Salary: ${{ extra.employee_salary_dollars|floatformat:2 }} / hr\n
                  {% if extra.employee_score is not None %}
                    Reputation Score: {{ extra.employee_score }}
                  {% endif %}
                {% else %}
                  <span class="text-muted">N/A</span>
                {% endif %}
              </td>
              <td>
                <a class="btn btn-sm btn-outline-primary" href="{% url 'profile' u.id %}">View Profile</a>
              </td>
            </tr>
            {% endwith %}
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="alert alert-info mb-0" role="alert">
        No users found.
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
